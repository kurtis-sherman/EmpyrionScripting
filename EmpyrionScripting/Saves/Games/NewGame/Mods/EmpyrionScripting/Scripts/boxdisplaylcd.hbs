{{~#devices E.S. '*[c]*'}}
{{~#each .}}
  {{~set 'CN' CustomName}}
  {{~set 'Vol' ./Device.VolumeCapacity}}
  {{~set 'T' 0}}
  {{~#split CustomName '-'}}
    {{~set 'DN' .1}}
  {{~/split}}
	{{~#items @root.E.S @root.Data.CN}}
		{{~#math @root.Data.T '+' (calc (configattr Id 'Volume') '*' Count)}}{{~set 'T' .}}{{~/math}}
	{{~/items}}
  {{~#math (calc @root.Data.T '/' @root.Data.Vol) '*' 100}}
    {{~set 'P' .}}
  {{/math}}
  {{~#test @root.Data.P leq '50'}}
    {{set 'c1' '1D1'}}
    {{set 'c2' '030'}}
  {{/test}}
  {{~#test @root.Data.P in '50-75'}}
    {{set 'c1' 'DA1'}}
    {{set 'c2' '220'}}
  {{/test}}
  {{~#test @root.Data.P in '75-90'}}
    {{set 'c1' 'B40'}}
    {{set 'c2' '310'}}
  {{/test}}
  {{~#test @root.Data.P geq '90'}}
    {{set 'c1' 'D11'}}
    {{set 'c2' '300'}}
  {{/test}}
{{@root.Data.T}}
{{~#devices @root.E.S (concat @root.Data.DN '_P')}}
{{~#each .}}
{{~settextblock .}}
<line-height=3.0>
<size=6>
<pos=20><size=6><color=yellow><i><b>{{@root.Data.DN}}</b></i><size=4><color=white> {{format @root.Data.P '{0}'}} % - {{datetime}}
<line-height=3>
<size=7>
<size=7>
<size=10><align=center><color=#{{@root.Data.c1}}>{{bar @root.Data.T 0 @root.Data.Vol 20 '#' (concat '<color=#' @root.Data.c2 '>_</color>')}}
<align=left>
<color=white><size=5>
{{#items @root.E.S @root.Data.CN}}
<pos=20><line-height=5>- [{{format Id '{0,4}'}}]:{{format Count '{0,5}'}} {{i18n Id}}
{{/items}}
{{~/settextblock}}
{{~/each}}
{{~/devices}}
{{~/each}}
{{~/devices}}